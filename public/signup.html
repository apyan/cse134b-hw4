<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Sign In</title>

    <link rel="stylesheet" type="text/css" href="stylesheet/amiiboTable.css">
    <link rel="stylesheet" type="text/css" href="stylesheet/buttonDesign.css">
    <link rel="stylesheet" type="text/css" href="stylesheet/divDesign.css">
    <link rel="stylesheet" type="text/css" href="stylesheet/textDesign.css">
    <script language="javascript" type="text/javascript" src="app.js"></script>

  </head>
  <body>

	<div>
		<button class="backButton" type="button" onclick="location.href='index.html'">Back</button>
		<h1 class="textLine_1">Sign Up</h1>
		
		<form class="textLine_1">
	    	Username:<br>
	    	<input id="username" class="inputText" type="text" name="username">
	    	<br>
		E-Mail Address:<br>
	    	<input id="email" class="inputText" type="email" name="email">
	    	<br>
	    	Password:<br>
	    	<input id="password" class="inputText" type="password" name="password">
	    	<br>
	    	Re-Password:<br>
	    	<input id="repassword" class="inputText" type="password" name="repassword">
	    	<br><br>
	    	<!--change to submit-->
	    	<input id="sign-up" class="modButton" type="button" value="Sign Up" onclick="signUpUserData()"/>
		</form>
		<p id="sign-up-status"> </p>
		<!-- <br><p id="test"></p> -->
	</div>
  <script src="https://www.gstatic.com/firebasejs/3.7.0/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyD3p9hdIYoCSi72wUMbPT-JkIzXPf6Xmrc",
      authDomain: "amiibodex.firebaseapp.com",
      databaseURL: "https://amiibodex.firebaseio.com",
      storageBucket: "amiibodex.appspot.com",
      messagingSenderId: "582801923363"
    };
    firebase.initializeApp(config);

    // Testing Sign-Up Button
    //var messagesRef = new Firebase('https://amiibodex.firebaseio.com/users');

    // Sign-Up Button is pressed
    function signUpUserData(){

        // Test Statements
        //document.getElementById("test").innerHTML = "Creating user...";

        var username = document.querySelector('#username').value;
        var password = document.querySelector('#password').value;
	var repassword = document.querySelector('#repassword').value;
        var email = document.querySelector('#email').value;

        // Test Statements
        //document.getElementById("test").innerHTML = username + " " + password + " " + email;

	// Checks if password and re-password are properly similar
	if(password.localeCompare(repassword) == 0){
        // Working Email and Password sign-in (Check Authentication -> Users)
        firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          /*if (errorCode == 'auth/weak-password') {
		//alert('The password is too weak.');
          }*/
		document.getElementById("sign-up-status").innerHTML = "Error: " + error.message;
        });

	// Authenticate User
        firebase.auth().onAuthStateChanged(function (user) {
          if(user) {
              //document.getElementById("test").innerHTML = "TRUE: " + user.email;
              alert("Successfully signed up!");

		/* Please delete the two alert messages in there! */
              writeNewUserData(username, password, user.uid);
              window.location.href='indexsignedin.html';
          } 
        });
	} else {
		document.getElementById("sign-up-status").innerHTML = "Error: The two passwords must match.";
	}
      } // signUpUserData() ends

  </script>

  <script type="text/javascript" src="test.js"></script>
  </body>
</html>
